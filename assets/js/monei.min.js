!function(e){"use strict";e(document.body).on("updated_checkout",(function(e,n){"object"==typeof n&&n.fragments&&n.fragments.monei_new_total&&(t.total=n.fragments.monei_new_total),t.is_monei_selected()&&(t.init_checkout_monei(),t.init_apple_google_pay())})),e("form#add_payment_method").on("click payment_methods",(function(){t.is_monei_selected()&&t.init_checkout_monei()})),e("form#order_review").on("click",(function(){t.is_monei_selected()&&t.init_checkout_monei()}));var n=document.getElementById("order_review");n&&new MutationObserver((function(e,n){for(var o of e)"childList"===o.type&&t.is_monei_selected()&&t.init_checkout_monei()})).observe(n,{childList:!0,subtree:!0});var t={$checkout_form:e("form.woocommerce-checkout"),$add_payment_form:e("form#add_payment_method"),$order_pay_form:e("form#order_review"),$cardInput:null,$container:null,$payment_request_container:"#payment_request_container",$errorContainer:null,$paymentForm:null,is_checkout:!1,is_add_payment_method:!1,is_order_pay:!1,form:null,submitted:!1,init_counter:0,total:wc_monei_params.total,init:function(){this.$checkout_form.length&&(this.is_checkout=!0,this.form=this.$checkout_form,this.form.on("checkout_place_order",this.place_order)),this.$add_payment_form.length&&(this.is_add_payment_method=!0,this.form=this.$add_payment_form,this.form.on("submit",this.place_order)),this.$order_pay_form.length&&(t.is_monei_selected()&&t.init_checkout_monei(),this.is_order_pay=!0,this.form=this.$order_pay_form,this.form.on("submit",this.place_order)),this.form&&this.form.on("change",this.on_change)},submit_form:function(){t.form.submit()},on_change:function(){e("[name='payment_method']").on("change",(function(){t.on_payment_selected()})),e("[name='wc-monei-payment-token']").on("change",(function(){t.on_payment_selected()}))},on_payment_selected(){t.is_monei_selected()?(t.init_checkout_monei(),t.is_checkout&&e("[name='woocommerce_checkout_place_order']").attr("data-monei","submit"),t.is_checkout&&wc_monei_params.apple_google_pay&&(t.is_tokenized_cc_selected()?t.hide_payment_request_container():t.show_payment_request_container())):t.is_checkout&&e("[name='woocommerce_checkout_place_order']").removeAttr("data-monei")},is_monei_selected:function(){return e("#payment_method_monei").is(":checked")},is_tokenized_cc_selected:function(){return e('input[name="wc-monei-payment-token"]').is(":checked")&&"new"!==e('input[name="wc-monei-payment-token"]:checked').val()},is_monei_saved_cc_selected:function(){return t.is_monei_selected()&&t.is_tokenized_cc_selected()},init_apple_google_pay:function(){wc_monei_params.apple_google_pay&&(window.paymentRequest&&window.paymentRequest.close(),t.instantiate_payment_request())},instantiate_payment_request:function(){var e=monei.PaymentRequest({accountId:wc_monei_params.account_id,sessionId:wc_monei_params.session_id,amount:parseInt(t.total),currency:wc_monei_params.currency,onSubmit(e){t.apple_google_token_handler(e.token)},onError(e){console.log(e)}});e.render("#payment-request-container"),window.paymentRequest=e},hide_payment_request_container:function(){e("#payment-request-container").hide()},show_payment_request_container:function(){e("#payment-request-container").show()},init_checkout_monei:function(){if(t.$container&&0===t.$container.childElementCount&&(t.init_counter=0),0===this.init_counter&&!t.is_monei_saved_cc_selected()){t.is_checkout&&e("[name='woocommerce_checkout_place_order']").attr("data-monei","submit"),t.init_apple_google_pay(),t.$container=document.getElementById("card-input"),t.$errorContainer=document.getElementById("monei-card-error");t.$cardInput=monei.CardInput({accountId:wc_monei_params.account_id,sessionId:wc_monei_params.session_id,style:{input:{fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"15px"},invalid:{color:"#fa755a"},icon:{marginRight:"0.4em"}},onChange:function(e){e.isTouched&&e.error?t.print_errors(e.error):t.clear_errors()},onEnter:function(){t.form.submit()},onFocus:function(){t.$container.classList.add("is-focused")},onBlur:function(){t.$container.classList.remove("is-focused")}}),t.$cardInput.render(t.$container),this.init_counter++}},place_order:function(n){return!!e("#monei_payment_token").length||(!!e("#monei_payment_request_token").length||(!t.is_monei_selected()||(!!t.is_monei_saved_cc_selected()||(n.preventDefault(),monei.createToken(t.$cardInput).then((function(e){e.error?(console.log("error",e.error),t.print_errors(e.error)):t.monei_token_handler(e.token)})).catch((function(e){console.log(e),t.print_errors(e.message)})),!1))))},print_errors:function(n){e(t.$errorContainer).html('<br /><ul class="woocommerce_error woocommerce-error monei-error"><li /></ul>'),e(t.$errorContainer).find("li").text(n),e(".monei-error").length&&e("html, body").animate({scrollTop:e(".monei-error").offset().top-200},200)},clear_errors:function(){e(".monei-error").remove()},monei_token_handler:function(e){t.create_hidden_input("monei_payment_token",e),t.form.submit()},apple_google_token_handler:function(e){t.create_hidden_input("monei_payment_request_token",e),t.form.submit()},create_hidden_input:function(e,n){console.log("token",n);var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name",e),o.setAttribute("id",e),o.setAttribute("value",n),t.$paymentForm=document.getElementById("payment-form"),t.$paymentForm.appendChild(o)},get_form:function(){return this.form}};e((function(){t.init()}))}(jQuery);
!function(e){"use strict";e(document.body).on("updated_checkout",function(e,o){"object"==typeof o&&o.fragments&&o.fragments.monei_new_total&&(n.total=o.fragments.monei_new_total),n.is_monei_selected()&&n.init_checkout_monei()}),e("form#add_payment_method").on("click payment_methods",function(){n.is_monei_selected()&&n.init_checkout_monei()}),e("form#order_review").on("click",function(){n.is_monei_selected()&&n.init_checkout_monei()});var n={$checkout_form:e("form.woocommerce-checkout"),$add_payment_form:e("form#add_payment_method"),$order_pay_form:e("form#order_review"),$cardInput:null,$container:null,$payment_request_container:null,$errorContainer:null,$paymentForm:null,is_checkout:!1,is_add_payment_method:!1,is_order_pay:!1,form:null,submitted:!1,init_counter:0,init_apple_counter:0,total:wc_monei_params.total,cardholderNameRegex:/^[A-Za-zÀ-ú- ]{5,50}$/,init:function(){this.$checkout_form.length&&(this.is_checkout=!0,this.form=this.$checkout_form,this.form.on("checkout_place_order",this.place_order)),this.$add_payment_form.length&&(this.is_add_payment_method=!0,this.form=this.$add_payment_form,this.form.on("submit",this.place_order)),this.$order_pay_form.length&&(n.is_monei_selected()&&n.on_payment_selected(),this.is_order_pay=!0,this.form=this.$order_pay_form,this.form.on("submit",this.place_order_page),e('input[name="payment_method"]').on("change",function(){n.is_monei_selected()&&n.init_checkout_monei()})),this.form&&this.form.on("change",this.on_change)},on_change:function(){e("[name='payment_method']").on("change",function(){n.on_payment_selected()}),e("[name='wc-monei-payment-token']").on("change",function(){n.on_payment_selected()})},on_payment_selected(){n.is_monei_selected()&&(n.init_checkout_monei(),e("#place_order").prop("disabled",!1),n.is_checkout&&e("[name='woocommerce_checkout_place_order']").attr("data-monei","submit"),n.is_tokenized_cc_selected()?e(".monei-input-container, .monei-card-input").hide():e(".monei-input-container, .monei-card-input").show())},validate_cardholder_name:function(){var o=e("#monei_cardholder_name").val();if(n.cardholderNameRegex.test(o))return n.clear_errors("#monei-cardholder-name-error"),!0;{const e=wc_monei_params.nameErrorString;return n.print_errors(e,"#monei-cardholder-name-error"),!1}},is_monei_selected:function(){return e("#payment_method_monei").is(":checked")},is_tokenized_cc_selected:function(){return e('input[name="wc-monei-payment-token"]').is(":checked")&&"new"!==e('input[name="wc-monei-payment-token"]:checked').val()},is_monei_saved_cc_selected:function(){return n.is_monei_selected()&&n.is_tokenized_cc_selected()},init_checkout_monei:function(){null===document.getElementById("monei-card-input")||(n.$container&&0===n.$container.childElementCount&&(n.init_counter=0),0!==this.init_counter||n.is_monei_saved_cc_selected())||(n.is_checkout&&e("[name='woocommerce_checkout_place_order']").attr("data-monei","submit"),e("#monei_cardholder_name").on("blur",function(){n.validate_cardholder_name()}),n.$container=document.getElementById("monei-card-input"),n.$errorContainer=document.getElementById("monei-card-error"),n.$cardInput=monei.CardInput({accountId:wc_monei_params.account_id,sessionId:wc_monei_params.session_id,style:{input:{fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"15px"},invalid:{color:"#fa755a"},icon:{marginRight:"0.4em"}},onChange:function(e){e.isTouched&&e.error?n.print_errors(e.error):n.clear_errors()},onEnter:function(){n.form.submit()},onFocus:function(){n.$container.classList.add("is-focused")},onBlur:function(){n.$container.classList.remove("is-focused")}}),n.$cardInput.render(n.$container),this.init_counter++)},place_order:function(e){return!!document.getElementById("monei_payment_token")||(n.is_monei_selected()&&!n.is_monei_saved_cc_selected()?!!n.validate_cardholder_name()&&(monei.createToken(n.$cardInput).then(function(e){e.error?(console.error("error",e.error),n.print_errors(e.error)):(console.log("token"),n.monei_token_handler(e.token))}).catch(function(e){console.error(e),n.print_errors(e.message)}),!1):void 0)},place_order_page:function(e){return!!document.getElementById("monei_payment_token")||(n.is_monei_selected()&&!n.is_monei_saved_cc_selected()?!!n.validate_cardholder_name()&&(e.preventDefault(),monei.createToken(n.$cardInput).then(function(e){e.error?(console.error("error",e.error),n.print_errors(e.error)):(console.log("token",e.token),n.monei_token_handler(e.token))}).catch(function(e){console.error(e),n.print_errors(e.message)}),!1):void 0)},print_errors:function(o,t){t||(t=n.$errorContainer),e(t).html('<br /><ul class="woocommerce_error woocommerce-error monei-error"><li /></ul>'),e(t).find("li").text(o),e(t).find(".monei-error").length&&e("html, body").animate({scrollTop:e(t).offset().top-200},200)},clear_errors:function(o){o||(o=n.$errorContainer),e(o).html("")},monei_token_handler:function(e){n.create_hidden_input("monei_payment_token","payment-form",e),n.form.submit()},create_hidden_input:function(e,o,t){var r=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name",e),r.setAttribute("id",e),r.setAttribute("value",t),n.$paymentForm=document.getElementById(o),n.$paymentForm.appendChild(r)}};e(function(){n.init()})}(jQuery);